import{r as a,j as e}from"./vendor-react-CCyQGCED.js";import{w as je,u as pe,t as fe,B as ge,e as z}from"./index-CV4quycg.js";import{q as be,K as ve,W as ye,S as X}from"./lightweight-charts.production-fmEoZjtL.js";import{C as l,a as n,b as i,d as c}from"./card-kWSQgWcE.js";import{I as y}from"./input-CqPkRK6n.js";import{S as J}from"./scroll-area-3cwyXfBA.js";import{S as L,a as C,b as F,c as A,d as h}from"./select-6OVOLKW_.js";import{T as W,a as q,b as g,c as d,d as O,e as o}from"./table-87YpB1sZ.js";import{Y as Ne,aw as we,i as Se,c as Le,a3 as Ce}from"./vendor-icons-CCn_k3dF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";async function Fe(b){return(await je.get("/manual_trades/analytics",{params:b})).data}function u(b){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(b)}const Q=[{label:"Last 1 Day",value:"1d",days:1},{label:"Last 7 Days",value:"7d",days:7},{label:"Last 30 Days",value:"30d",days:30},{label:"Last 90 Days",value:"90d",days:90},{label:"All",value:"all",days:null}];function ze(){const{mode:b}=pe(),j=b==="dark",[$,H]=a.useState(!1),[p,Z]=a.useState(null),[N,ee]=a.useState("ALL"),[w,se]=a.useState("ALL"),[S,ae]=a.useState("ALL"),[T,re]=a.useState(""),[_,te]=a.useState(""),[k,le]=a.useState("7d"),[P,ne]=a.useState("2000"),[R,ie]=a.useState("50"),[D,ce]=a.useState("5"),E=a.useRef(null),m=a.useRef(null),M=a.useRef(null),I=a.useRef(null),U=a.useMemo(()=>{const s=Q.find(f=>f.value===k);return s?.days?new Date(Date.now()-s.days*24*60*60*1e3).toISOString():void 0},[k]),v=a.useMemo(()=>{const s=Number.parseInt(P,10),t=Number.parseFloat(R),f=Number.parseInt(D,10);return{limit:Number.isFinite(s)?s:2e3,bucket:Number.isFinite(t)?t:50,interval_min:Number.isFinite(f)?f:5,mode:N==="ALL"?void 0:N,source:w==="ALL"?void 0:w,side:S==="ALL"?void 0:S,underlying:T||void 0,symbol:_||void 0,since:U}},[P,R,D,N,w,S,T,_,U]),Y=a.useCallback(async(s=v)=>{H(!0);try{const t=await Fe(s);Z(t)}catch(t){console.error("Failed to load Manual Trade analytics",t),fe.error("Failed to load Manual Trade analytics")}finally{H(!1)}},[v]),G=a.useCallback(()=>{if(!E.current)return;m.current&&(m.current.remove(),m.current=null);const s=E.current,t=be(s,{width:s.offsetWidth,height:320,layout:{background:{type:ye.Solid,color:"transparent"},textColor:j?"#a6adbb":"#333"},grid:{vertLines:{color:j?"rgba(166, 173, 187, 0.1)":"rgba(0, 0, 0, 0.1)"},horzLines:{color:j?"rgba(166, 173, 187, 0.1)":"rgba(0, 0, 0, 0.1)"}},timeScale:{timeVisible:!0,secondsVisible:!1},rightPriceScale:{borderColor:j?"rgba(166, 173, 187, 0.2)":"rgba(0, 0, 0, 0.2)"},crosshair:{mode:ve.Normal,vertLine:{width:1,color:j?"rgba(166, 173, 187, 0.5)":"rgba(0, 0, 0, 0.3)",style:2,labelVisible:!1},horzLine:{width:1,color:j?"rgba(166, 173, 187, 0.5)":"rgba(0, 0, 0, 0.3)"}}}),f=t.addSeries(X,{lineColor:"#00d4ff",topColor:"rgba(0, 212, 255, 0.35)",bottomColor:"rgba(0, 212, 255, 0.0)",lineWidth:2,priceFormat:{type:"custom",formatter:B=>u(B)}}),x=t.addSeries(X,{lineColor:"#ff6b6b",topColor:"rgba(255, 107, 107, 0.0)",bottomColor:"rgba(255, 107, 107, 0.35)",lineWidth:2,priceFormat:{type:"custom",formatter:B=>u(B)}});m.current=t,M.current=f,I.current=x;const K=()=>{m.current&&s&&m.current.applyOptions({width:s.offsetWidth})};return window.addEventListener("resize",K),()=>window.removeEventListener("resize",K)},[j]);a.useEffect(()=>{const s=G();return()=>{s?.(),m.current&&(m.current.remove(),m.current=null)}},[G]),a.useEffect(()=>{const s=p?.equity??[];if(!M.current||!I.current)return;const t=s.filter(x=>x.time).map(x=>({time:x.time,value:x.value})),f=s.filter(x=>x.time).map(x=>({time:x.time,value:x.drawdown}));M.current.setData(t),I.current.setData(f)},[p]),a.useEffect(()=>{Y(v)},[]);const r=p?.summary,V=p?.distribution??[],de=Math.max(1,...V.map(s=>s.count)),oe=p?.time_buckets??[],xe=p?.reason_breakdown??[],he=p?.side_breakdown??[],ue=a.useMemo(()=>{if(!r)return[];const s=[];return r.total_trades<20&&s.push("Low sample size — collect more manual trades before analysis."),r.win_rate<45&&s.push("Win rate is low — review entry/exit discipline."),r.profit_factor!==null&&r.profit_factor<1&&s.push("Profit factor < 1 — aim to increase average win or cut loss size."),r.avg_hold_s!==null&&r.avg_hold_s<10&&s.push("Avg hold time is very short — consider holding winners longer."),r.max_drawdown>Math.abs(r.total_pnl)&&r.total_pnl>0&&s.push("Drawdown exceeds net P&L — tighten risk or reduce size."),s.length||s.push("Metrics look stable — compare with Auto Analytics to tune strategy."),s},[r]),me=s=>s>=0?e.jsxs(z,{className:"bg-emerald-500/20 text-emerald-200 hover:bg-emerald-500/20",children:[e.jsx(Le,{className:"mr-1 h-3 w-3"}),u(s)]}):e.jsxs(z,{className:"bg-rose-500/20 text-rose-200 hover:bg-rose-500/20",children:[e.jsx(Ce,{className:"mr-1 h-3 w-3"}),u(s)]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Manual Trade Analytics"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View performance of trades from Scalping and Chart windows."})]}),e.jsxs(ge,{onClick:()=>Y(v),disabled:$,children:[e.jsx(Ne,{className:`mr-2 h-4 w-4 ${$?"animate-spin":""}`}),"Apply Filters"]})]}),e.jsxs(l,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between",children:[e.jsxs(i,{className:"flex items-center gap-2 text-base",children:[e.jsx(we,{className:"h-4 w-4"}),"Filters"]}),e.jsxs(z,{variant:"secondary",children:["Limit ",p?.limit??v.limit]})]}),e.jsxs(c,{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mode"}),e.jsxs(L,{value:N,onValueChange:ee,children:[e.jsx(C,{children:e.jsx(F,{placeholder:"All"})}),e.jsxs(A,{children:[e.jsx(h,{value:"ALL",children:"All"}),e.jsx(h,{value:"PAPER",children:"Paper"}),e.jsx(h,{value:"LIVE",children:"Live"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Source"}),e.jsxs(L,{value:w,onValueChange:se,children:[e.jsx(C,{children:e.jsx(F,{placeholder:"All"})}),e.jsxs(A,{children:[e.jsx(h,{value:"ALL",children:"All"}),e.jsx(h,{value:"scalping",children:"Scalping"}),e.jsx(h,{value:"chart",children:"Chart"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Side"}),e.jsxs(L,{value:S,onValueChange:ae,children:[e.jsx(C,{children:e.jsx(F,{placeholder:"All"})}),e.jsxs(A,{children:[e.jsx(h,{value:"ALL",children:"All"}),e.jsx(h,{value:"CE",children:"CE"}),e.jsx(h,{value:"PE",children:"PE"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Underlying"}),e.jsx(y,{placeholder:"NIFTY / SENSEX",value:T,onChange:s=>re(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Symbol"}),e.jsx(y,{placeholder:"NFO:NIFTY...",value:_,onChange:s=>te(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Range"}),e.jsxs(L,{value:k,onValueChange:le,children:[e.jsx(C,{children:e.jsx(F,{placeholder:"Last 7 Days"})}),e.jsx(A,{children:Q.map(s=>e.jsx(h,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Limit"}),e.jsx(y,{value:P,onChange:s=>ne(s.target.value),placeholder:"2000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bucket (₹)"}),e.jsx(y,{value:R,onChange:s=>ie(s.target.value),placeholder:"50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Time Bucket (min)"}),e.jsx(y,{value:D,onChange:s=>ce(s.target.value),placeholder:"5"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-6",children:[e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Total P&L"})}),e.jsx(c,{children:r?me(r.total_pnl):"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Trades"})}),e.jsx(c,{className:"text-xl font-semibold",children:r?.total_trades??"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Win Rate"})}),e.jsx(c,{className:"text-xl font-semibold",children:r?`${r.win_rate.toFixed(1)}%`:"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Profit Factor"})}),e.jsx(c,{className:"text-xl font-semibold",children:r?.profit_factor??"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Avg P&L"})}),e.jsx(c,{className:"text-xl font-semibold",children:r?u(r.avg_pnl):"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Max Drawdown"})}),e.jsx(c,{className:"text-xl font-semibold",children:r?u(r.max_drawdown):"--"})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2 text-base",children:[e.jsx(Se,{className:"h-4 w-4"}),"Equity Curve & Drawdown"]})}),e.jsx(c,{children:e.jsx("div",{ref:E,className:"h-[320px]"})})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"PnL Distribution"})}),e.jsxs(c,{children:[e.jsx("div",{className:"flex items-end gap-1 h-40",children:V.map(s=>e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"rounded bg-cyan-500/70",style:{height:`${s.count/de*100}%`},title:`₹${s.bucket} : ${s.count}`})},s.bucket))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2 text-xs text-muted-foreground",children:V.slice(0,6).map(s=>e.jsxs("span",{children:[s.bucket>=0?"+":"",s.bucket,": ",s.count]},s.bucket))})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"Side Breakdown"})}),e.jsx(c,{children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(g,{children:[e.jsx(d,{children:"Side"}),e.jsx(d,{children:"Trades"}),e.jsx(d,{children:"Win%"}),e.jsx(d,{children:"P&L"})]})}),e.jsx(O,{children:he.map(s=>e.jsxs(g,{children:[e.jsx(o,{children:s.side}),e.jsx(o,{children:s.count}),e.jsxs(o,{children:[s.win_rate.toFixed(1),"%"]}),e.jsx(o,{children:u(s.pnl)})]},s.side))})]})})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"Exit Reasons"})}),e.jsx(c,{children:e.jsx(J,{className:"h-40",children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(g,{children:[e.jsx(d,{children:"Reason"}),e.jsx(d,{children:"Trades"}),e.jsx(d,{children:"P&L"})]})}),e.jsx(O,{children:xe.map(s=>e.jsxs(g,{children:[e.jsx(o,{children:s.reason}),e.jsx(o,{children:s.count}),e.jsx(o,{children:u(s.pnl)})]},s.reason))})]})})})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"Time-of-Day Performance"})}),e.jsx(c,{children:e.jsx(J,{className:"h-60",children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(g,{children:[e.jsx(d,{children:"Bucket"}),e.jsx(d,{children:"Trades"}),e.jsx(d,{children:"Win%"}),e.jsx(d,{children:"Avg P&L"}),e.jsx(d,{children:"Total P&L"})]})}),e.jsx(O,{children:oe.map(s=>e.jsxs(g,{children:[e.jsx(o,{children:s.bucket}),e.jsx(o,{children:s.count}),e.jsxs(o,{children:[s.win_rate.toFixed(1),"%"]}),e.jsx(o,{children:u(s.avg_pnl)}),e.jsx(o,{children:u(s.pnl)})]},s.bucket))})]})})})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"Manual Insights"})}),e.jsx(c,{children:e.jsx("ul",{className:"list-disc space-y-2 pl-4 text-sm text-muted-foreground",children:ue.map(s=>e.jsx("li",{children:s},s))})})]})]})}export{ze as default};
