import{r,j as e}from"./vendor-react-BsSNOS8Q.js";import{u as je,t as fe,B as pe,e as z}from"./index-pkdFY1Bt.js";import{q as ge,K as be,W as ve,S as X}from"./lightweight-charts.production-fmEoZjtL.js";import{f as Ne}from"./ai-scalper-C27xgijK.js";import{C as l,a as n,b as i,d as c}from"./card-CQoVF7GG.js";import{I as v}from"./input-BGeT81mD.js";import{S as J}from"./scroll-area-BsEbKr6o.js";import{S as L,a as w,b as C,c as A,d as h}from"./select-D93G_iSt.js";import{T as W,a as q,b as g,c as d,d as O,e as o}from"./table-0IrsMSFl.js";import{R as ye,an as Se,s as Le,w as we,x as Ce}from"./vendor-icons-BJR3KiwM.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-b1Q1Drqs.js";import"./vendor-radix-DB8xhlcH.js";function m(F){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(F)}const Q=[{label:"Last 1 Day",value:"1d",days:1},{label:"Last 7 Days",value:"7d",days:7},{label:"Last 30 Days",value:"30d",days:30},{label:"Last 90 Days",value:"90d",days:90},{label:"All",value:"all",days:null}];function ze(){const{mode:F}=je(),p=F==="dark",[$,H]=r.useState(!1),[j,Z]=r.useState(null),[N,ee]=r.useState("ALL"),[y,se]=r.useState("ALL"),[S,re]=r.useState("ALL"),[T,te]=r.useState(""),[k,ae]=r.useState(""),[_,le]=r.useState("7d"),[R,ne]=r.useState("2000"),[P,ie]=r.useState("50"),[D,ce]=r.useState("5"),E=r.useRef(null),u=r.useRef(null),I=r.useRef(null),B=r.useRef(null),U=r.useMemo(()=>{const s=Q.find(f=>f.value===_);return s?.days?new Date(Date.now()-s.days*24*60*60*1e3).toISOString():void 0},[_]),b=r.useMemo(()=>{const s=Number.parseInt(R,10),a=Number.parseFloat(P),f=Number.parseInt(D,10);return{limit:Number.isFinite(s)?s:2e3,bucket:Number.isFinite(a)?a:50,interval_min:Number.isFinite(f)?f:5,mode:N==="ALL"?void 0:N,source:y==="ALL"?void 0:y,side:S==="ALL"?void 0:S,underlying:T||void 0,symbol:k||void 0,since:U}},[R,P,D,N,y,S,T,k,U]),Y=r.useCallback(async(s=b)=>{H(!0);try{const a=await Ne(s);Z(a)}catch(a){console.error("Failed to load AutoTrade analytics",a),fe.error("Failed to load AutoTrade analytics")}finally{H(!1)}},[b]),G=r.useCallback(()=>{if(!E.current)return;u.current&&(u.current.remove(),u.current=null);const s=E.current,a=ge(s,{width:s.offsetWidth,height:320,layout:{background:{type:ve.Solid,color:"transparent"},textColor:p?"#a6adbb":"#333"},grid:{vertLines:{color:p?"rgba(166, 173, 187, 0.1)":"rgba(0, 0, 0, 0.1)"},horzLines:{color:p?"rgba(166, 173, 187, 0.1)":"rgba(0, 0, 0, 0.1)"}},timeScale:{timeVisible:!0,secondsVisible:!1},rightPriceScale:{borderColor:p?"rgba(166, 173, 187, 0.2)":"rgba(0, 0, 0, 0.2)"},crosshair:{mode:be.Normal,vertLine:{width:1,color:p?"rgba(166, 173, 187, 0.5)":"rgba(0, 0, 0, 0.3)",style:2,labelVisible:!1},horzLine:{width:1,color:p?"rgba(166, 173, 187, 0.5)":"rgba(0, 0, 0, 0.3)"}}}),f=a.addSeries(X,{lineColor:"#00d4ff",topColor:"rgba(0, 212, 255, 0.35)",bottomColor:"rgba(0, 212, 255, 0.0)",lineWidth:2,priceFormat:{type:"custom",formatter:M=>m(M)}}),x=a.addSeries(X,{lineColor:"#ff6b6b",topColor:"rgba(255, 107, 107, 0.0)",bottomColor:"rgba(255, 107, 107, 0.35)",lineWidth:2,priceFormat:{type:"custom",formatter:M=>m(M)}});u.current=a,I.current=f,B.current=x;const K=()=>{u.current&&s&&u.current.applyOptions({width:s.offsetWidth})};return window.addEventListener("resize",K),()=>window.removeEventListener("resize",K)},[p]);r.useEffect(()=>{const s=G();return()=>{s?.(),u.current&&(u.current.remove(),u.current=null)}},[G]),r.useEffect(()=>{const s=j?.equity??[];if(!I.current||!B.current)return;const a=s.filter(x=>x.time).map(x=>({time:x.time,value:x.value})),f=s.filter(x=>x.time).map(x=>({time:x.time,value:x.drawdown}));I.current.setData(a),B.current.setData(f)},[j]),r.useEffect(()=>{Y(b)},[]);const t=j?.summary,V=j?.distribution??[],de=Math.max(1,...V.map(s=>s.count)),oe=j?.time_buckets??[],xe=j?.reason_breakdown??[],he=j?.side_breakdown??[],me=r.useMemo(()=>{if(!t)return[];const s=[];return t.total_trades<20&&s.push("Low sample size — collect more trades before tuning."),t.win_rate<45&&s.push("Win rate is low — consider stricter entry filters or higher momentum ticks."),t.profit_factor!==null&&t.profit_factor<1&&s.push("Profit factor < 1 — increase average win or reduce loss size."),t.avg_hold_s!==null&&t.avg_hold_s<10&&s.push("Avg hold time is very short — increase BE delay or trail distance."),t.max_drawdown>Math.abs(t.total_pnl)&&t.total_pnl>0&&s.push("Drawdown exceeds net P&L — tighten risk or reduce max lots."),s.length||s.push("Metrics look stable — keep monitoring and scale cautiously."),s},[t]),ue=s=>s>=0?e.jsxs(z,{className:"bg-emerald-500/20 text-emerald-200 hover:bg-emerald-500/20",children:[e.jsx(we,{className:"mr-1 h-3 w-3"}),m(s)]}):e.jsxs(z,{className:"bg-rose-500/20 text-rose-200 hover:bg-rose-500/20",children:[e.jsx(Ce,{className:"mr-1 h-3 w-3"}),m(s)]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"AutoTrade Analytics"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Visualize AutoTrade performance, breakdowns, and momentum over time."})]}),e.jsxs(pe,{onClick:()=>Y(b),disabled:$,children:[e.jsx(ye,{className:`mr-2 h-4 w-4 ${$?"animate-spin":""}`}),"Apply Filters"]})]}),e.jsxs(l,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between",children:[e.jsxs(i,{className:"flex items-center gap-2 text-base",children:[e.jsx(Se,{className:"h-4 w-4"}),"Filters"]}),e.jsxs(z,{variant:"secondary",children:["Limit ",j?.limit??b.limit]})]}),e.jsxs(c,{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mode"}),e.jsxs(L,{value:N,onValueChange:ee,children:[e.jsx(w,{children:e.jsx(C,{placeholder:"All"})}),e.jsxs(A,{children:[e.jsx(h,{value:"ALL",children:"All"}),e.jsx(h,{value:"PAPER",children:"Paper"}),e.jsx(h,{value:"LIVE",children:"Live"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Source"}),e.jsxs(L,{value:y,onValueChange:se,children:[e.jsx(w,{children:e.jsx(C,{placeholder:"All"})}),e.jsxs(A,{children:[e.jsx(h,{value:"ALL",children:"All"}),e.jsx(h,{value:"local",children:"Local"}),e.jsx(h,{value:"server",children:"Server"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Side"}),e.jsxs(L,{value:S,onValueChange:re,children:[e.jsx(w,{children:e.jsx(C,{placeholder:"All"})}),e.jsxs(A,{children:[e.jsx(h,{value:"ALL",children:"All"}),e.jsx(h,{value:"CE",children:"CE"}),e.jsx(h,{value:"PE",children:"PE"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Underlying"}),e.jsx(v,{placeholder:"NIFTY / SENSEX",value:T,onChange:s=>te(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Symbol"}),e.jsx(v,{placeholder:"NFO:NIFTY...",value:k,onChange:s=>ae(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Range"}),e.jsxs(L,{value:_,onValueChange:le,children:[e.jsx(w,{children:e.jsx(C,{placeholder:"Last 7 Days"})}),e.jsx(A,{children:Q.map(s=>e.jsx(h,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Limit"}),e.jsx(v,{value:R,onChange:s=>ne(s.target.value),placeholder:"2000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bucket (₹)"}),e.jsx(v,{value:P,onChange:s=>ie(s.target.value),placeholder:"50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Time Bucket (min)"}),e.jsx(v,{value:D,onChange:s=>ce(s.target.value),placeholder:"5"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-6",children:[e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Total P&L"})}),e.jsx(c,{children:t?ue(t.total_pnl):"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Trades"})}),e.jsx(c,{className:"text-xl font-semibold",children:t?.total_trades??"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Win Rate"})}),e.jsx(c,{className:"text-xl font-semibold",children:t?`${t.win_rate.toFixed(1)}%`:"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Profit Factor"})}),e.jsx(c,{className:"text-xl font-semibold",children:t?.profit_factor??"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Avg P&L"})}),e.jsx(c,{className:"text-xl font-semibold",children:t?m(t.avg_pnl):"--"})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-sm",children:"Max Drawdown"})}),e.jsx(c,{className:"text-xl font-semibold",children:t?m(t.max_drawdown):"--"})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2 text-base",children:[e.jsx(Le,{className:"h-4 w-4"}),"Equity Curve & Drawdown"]})}),e.jsx(c,{children:e.jsx("div",{ref:E,className:"h-[320px]"})})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"PnL Distribution"})}),e.jsxs(c,{children:[e.jsx("div",{className:"flex items-end gap-1 h-40",children:V.map(s=>e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"rounded bg-cyan-500/70",style:{height:`${s.count/de*100}%`},title:`₹${s.bucket} : ${s.count}`})},s.bucket))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2 text-xs text-muted-foreground",children:V.slice(0,6).map(s=>e.jsxs("span",{children:[s.bucket>=0?"+":"",s.bucket,": ",s.count]},s.bucket))})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"Side Breakdown"})}),e.jsx(c,{children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(g,{children:[e.jsx(d,{children:"Side"}),e.jsx(d,{children:"Trades"}),e.jsx(d,{children:"Win%"}),e.jsx(d,{children:"P&L"})]})}),e.jsx(O,{children:he.map(s=>e.jsxs(g,{children:[e.jsx(o,{children:s.side}),e.jsx(o,{children:s.count}),e.jsxs(o,{children:[s.win_rate.toFixed(1),"%"]}),e.jsx(o,{children:m(s.pnl)})]},s.side))})]})})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"Exit Reasons"})}),e.jsx(c,{children:e.jsx(J,{className:"h-40",children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(g,{children:[e.jsx(d,{children:"Reason"}),e.jsx(d,{children:"Trades"}),e.jsx(d,{children:"P&L"})]})}),e.jsx(O,{children:xe.map(s=>e.jsxs(g,{children:[e.jsx(o,{children:s.reason}),e.jsx(o,{children:s.count}),e.jsx(o,{children:m(s.pnl)})]},s.reason))})]})})})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"Time-of-Day Performance"})}),e.jsx(c,{children:e.jsx(J,{className:"h-60",children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(g,{children:[e.jsx(d,{children:"Bucket"}),e.jsx(d,{children:"Trades"}),e.jsx(d,{children:"Win%"}),e.jsx(d,{children:"Avg P&L"}),e.jsx(d,{children:"Total P&L"})]})}),e.jsx(O,{children:oe.map(s=>e.jsxs(g,{children:[e.jsx(o,{children:s.bucket}),e.jsx(o,{children:s.count}),e.jsxs(o,{children:[s.win_rate.toFixed(1),"%"]}),e.jsx(o,{children:m(s.avg_pnl)}),e.jsx(o,{children:m(s.pnl)})]},s.bucket))})]})})})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-base",children:"Auto Insights"})}),e.jsx(c,{children:e.jsx("ul",{className:"list-disc space-y-2 pl-4 text-sm text-muted-foreground",children:me.map(s=>e.jsx("li",{children:s},s))})})]})]})}export{ze as default};
