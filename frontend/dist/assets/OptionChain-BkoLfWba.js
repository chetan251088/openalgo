import{r as l,j as e,a as $e}from"./vendor-react-CCyQGCED.js";import{D as Re,j as Ie,B as I,k as Be,A as be,C as De,E as he,n as Ne,G as Oe,c as f,e as Ve,d as we,s as ce}from"./index-C6mW-S7J.js";import{u as Ge}from"./useOptionChainLive-B1bJW7x5.js";import{o as Le}from"./oi-profile-BsUGigdw.js";import{i as Ke,a1 as He,ae as We,aT as Xe,aU as Je,Y as Pe,c as Ze,aV as es,m as ss,aB as ts,aD as as}from"./vendor-icons-CCn_k3dF.js";import{D as Ue,a as rs,b as Ae,c as qe,d as ze,e as ns,f as Ye,g as ls}from"./dialog-Cmx8EPFL.js";import{S as Te}from"./scroll-area-5QzPKLul.js";import{I as ye}from"./input-QT7OR2Db.js";import{L as te}from"./label-gJML_ITX.js";import{S as oe,a as de,b as ue,c as me,d as xe}from"./select-CFgpE2WL.js";import{t as Ce}from"./trading-BQsFIo0D.js";import{u as is,a as cs}from"./useMarketStatus-Uz9bTNzH.js";import{C as os,b as ds,a as us}from"./collapsible-DcfHjv7p.js";import{C as ae,d as re}from"./card-DSoAFolw.js";import{P as ms,a as xs,b as ps,C as hs,c as gs,d as fs,e as bs,f as js,g as ys}from"./popover-DD0u2vLS.js";import{T as vs,a as Ns,b as Se,c as ne,d as Cs,e as ve}from"./table-Cb3YYl5l.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";const V=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],Ss=V.map(t=>t.key),ws=V.filter(t=>t.defaultVisible).map(t=>t.key),Y={visibleColumns:ws,columnOrder:Ss,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Qe="openalgo_option_chain_prefs";function ks(){if(typeof window>"u")return Y;try{const t=localStorage.getItem(Qe);if(!t)return Y;const s=JSON.parse(t),r=new Set(V.map(o=>o.key)),n=Array.isArray(s.visibleColumns)?s.visibleColumns.filter(o=>r.has(o)):Y.visibleColumns;n.includes("strike")||n.push("strike");const u=Array.isArray(s.columnOrder)?s.columnOrder.filter(o=>r.has(o)):Y.columnOrder,d=new Set(u);return Y.columnOrder.forEach(o=>{d.has(o)||u.push(o)}),{visibleColumns:n,columnOrder:u,strikeCount:typeof s.strikeCount=="number"&&s.strikeCount>0?s.strikeCount:Y.strikeCount,selectedUnderlying:typeof s.selectedUnderlying=="string"&&s.selectedUnderlying?s.selectedUnderlying:Y.selectedUnderlying,barDataSource:s.barDataSource==="oi"||s.barDataSource==="volume"?s.barDataSource:Y.barDataSource,barStyle:s.barStyle==="gradient"||s.barStyle==="solid"?s.barStyle:Y.barStyle}}catch{return Y}}function Ds(t){if(!(typeof window>"u"))try{localStorage.setItem(Qe,JSON.stringify(t))}catch{}}function Os(){const[t,s]=l.useState(()=>ks());l.useEffect(()=>{Ds(t)},[t]);const r=l.useCallback(a=>{a!=="strike"&&s(p=>{const S=p.visibleColumns.includes(a)?p.visibleColumns.filter(U=>U!==a):[...p.visibleColumns,a];return{...p,visibleColumns:S}})},[]),n=l.useCallback(a=>{s(p=>({...p,columnOrder:a}))},[]),u=l.useCallback(a=>{s(p=>({...p,strikeCount:a}))},[]),d=l.useCallback(a=>{s(p=>({...p,selectedUnderlying:a}))},[]),o=l.useCallback(a=>{s(p=>({...p,barDataSource:a}))},[]),b=l.useCallback(a=>{s(p=>({...p,barStyle:a}))},[]),y=l.useCallback(()=>{s(Y)},[]),C=l.useCallback(a=>t.visibleColumns.includes(a),[t.visibleColumns]),i=l.useCallback(()=>t.columnOrder.filter(a=>t.visibleColumns.includes(a)),[t.columnOrder,t.visibleColumns]);return{preferences:t,visibleColumns:t.visibleColumns,columnOrder:t.columnOrder,strikeCount:t.strikeCount,selectedUnderlying:t.selectedUnderlying,barDataSource:t.barDataSource,barStyle:t.barStyle,toggleColumn:r,reorderColumns:n,setStrikeCount:u,setSelectedUnderlying:d,setBarDataSource:o,setBarStyle:b,resetToDefaults:y,isColumnVisible:C,getOrderedVisibleColumns:i}}function Ls({barDataSource:t,barStyle:s,onBarDataSourceChange:r,onBarStyleChange:n}){return e.jsxs(Re,{children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Be,{align:"end",className:"w-48",children:[e.jsx(be,{children:"Bar Data"}),e.jsxs(De,{value:t,onValueChange:u=>r(u),children:[e.jsx(he,{value:"oi",children:"Open Interest"}),e.jsx(he,{value:"volume",children:"Volume"})]}),e.jsx(Ne,{}),e.jsx(be,{children:"Bar Style"}),e.jsxs(De,{value:s,onValueChange:u=>n(u),children:[e.jsx(he,{value:"gradient",children:"Gradient"}),e.jsx(he,{value:"solid",children:"Solid"})]})]})]})}function Ps({visibleColumns:t,onToggleColumn:s,onResetToDefaults:r}){const n=V.filter(o=>o.side==="ce"),u=V.filter(o=>o.side==="pe"),d=o=>t.includes(o);return e.jsxs(Re,{children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Be,{align:"end",className:"w-48",children:[e.jsx(be,{children:"CALLS Columns"}),n.map(o=>e.jsx(Oe,{checked:d(o.key),onCheckedChange:()=>s(o.key),children:o.label},o.key)),e.jsx(Ne,{}),e.jsx(be,{children:"PUTS Columns"}),u.map(o=>e.jsx(Oe,{checked:d(o.key),onCheckedChange:()=>s(o.key),children:o.label},o.key)),e.jsx(Ne,{}),e.jsxs(I,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:r,children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Ee({columnKey:t,label:s,side:r,isVisible:n,isDragging:u,onDragStart:d,onDragOver:o,onDrop:b,onDragEnd:y}){return e.jsxs("div",{draggable:!0,onDragStart:C=>d(C,t),onDragOver:o,onDrop:C=>b(C,t),onDragEnd:y,className:f("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",u&&"opacity-50 border-dashed",n?"bg-card":"bg-muted/50 opacity-60",r==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:s}),e.jsx("span",{className:f("text-xs px-1.5 py-0.5 rounded",r==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:r==="ce"?"CE":"PE"})]})}function Ts({columnOrder:t,visibleColumns:s,onReorderColumns:r}){const[n,u]=l.useState(t),[d,o]=l.useState(null),[b,y]=l.useState(!1),C=n.filter(x=>V.find(O=>O.key===x)?.side==="ce"),i=n.filter(x=>V.find(O=>O.key===x)?.side==="pe"),a=x=>V.find(O=>O.key===x)?.label??x,p=x=>V.find(O=>O.key===x)?.side==="pe"?"pe":"ce",j=(x,L)=>{o(L),x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",L)},S=x=>{x.preventDefault(),x.dataTransfer.dropEffect="move"},U=(x,L)=>{if(x.preventDefault(),!d||d===L)return;const O=p(d),M=p(L);if(O!==M)return;const T=[...n],h=T.indexOf(d),E=T.indexOf(L);T.splice(h,1),T.splice(E,0,d),u(T)},B=()=>{o(null)},A=()=>{r(n),y(!1)},D=x=>{y(x),x&&u(t)};return e.jsxs(Ue,{open:b,onOpenChange:D,children:[e.jsx(rs,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(Ae,{className:"sm:max-w-md",children:[e.jsxs(qe,{children:[e.jsx(ze,{children:"Reorder Columns"}),e.jsx(ns,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Te,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:C.map(x=>e.jsx(Ee,{columnKey:x,label:a(x),side:"ce",isVisible:s.includes(x),isDragging:d===x,onDragStart:j,onDragOver:S,onDrop:U,onDragEnd:B},x))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Te,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:i.map(x=>e.jsx(Ee,{columnKey:x,label:a(x),side:"pe",isVisible:s.includes(x),isDragging:d===x,onDragStart:j,onDragOver:S,onDrop:U,onDragEnd:B},x))})})]})]}),e.jsxs(Ye,{className:"gap-2 sm:gap-0",children:[e.jsx(ls,{asChild:!0,children:e.jsx(I,{variant:"outline",children:"Cancel"})}),e.jsx(I,{onClick:A,children:"Save Order"})]})]})]})}function Es(t){switch(t){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function _s({exchange:t,ltp:s,prevClose:r,change:n,changePercent:u,bidPrice:d,askPrice:o,bidSize:b,askSize:y,isLoading:C}){const i=n??(s&&r?s-r:void 0),a=u??(i&&r?i/r*100:void 0),p=i!==void 0&&i>=0;return C?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ve,{className:f("text-[10px] px-1.5 py-0",Es(t)),children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:s!==void 0?s.toFixed(2):"-"}),i!==void 0&&e.jsxs("span",{className:f("text-sm font-medium",p?"text-green-500":"text-red-500"),children:[p?"+":"",i.toFixed(2),a!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",p?"+":"",a.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:d!==void 0&&d>0?d.toFixed(2):"-"}),b!==void 0&&b>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",b.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:o!==void 0&&o>0?o.toFixed(2):"-"}),y!==void 0&&y>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",y.toLocaleString()]})]})]})]})}function _e({price:t,quantity:s,maxQty:r,side:n}){const u=r>0?Math.min(s/r*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:f("absolute top-0 bottom-0 transition-all duration-300",n==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${u}%`}})}),e.jsx("span",{className:f("relative z-10 flex-1 font-mono text-xs",n==="buy"?"text-emerald-400":"text-rose-400"),children:t.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:s.toLocaleString()})]})}function Ms({depth:t,isExpanded:s,onToggle:r,maxLevels:n=5}){const u=t?.buy?.slice(0,n)??[],d=t?.sell?.slice(0,n)??[],o=Math.max(...u.map(i=>i.quantity),1),b=Math.max(...d.map(i=>i.quantity),1),y=Math.max(o,b),C=u.length>0||d.length>0;return e.jsxs(os,{open:s,onOpenChange:r,children:[e.jsxs(ds,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s?"[-]":"[+]"})]}),e.jsx(us,{children:C?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:u.length>0?u.map((i,a)=>e.jsx(_e,{price:i.price,quantity:i.quantity,maxQty:y,side:"buy"},`buy-${a}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:d.length>0?d.map((i,a)=>e.jsx(_e,{price:i.price,quantity:i.quantity,maxQty:y,side:"sell"},`sell-${a}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:u.reduce((i,a)=>i+a.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:d.reduce((i,a)=>i+a.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}function Fs(t,s,r={}){const{enabled:n=!0,mode:u="Depth",useQuotesFallback:d=!0,useDepthFallback:o=!0,staleThreshold:b=5e3,refreshInterval:y=3e4}=r,{apiKey:C}=we(),{isMarketOpen:i}=is(),[a,p]=l.useState(null),[j,S]=l.useState(null),[U,B]=l.useState(!1),A=l.useRef(0),D=!!t&&!!s,x=l.useMemo(()=>D?[{symbol:t,exchange:s}]:[],[t,s,D]),{data:L,isConnected:O,isPaused:M,isFallbackMode:T}=cs({symbols:x,mode:u,enabled:n&&D}),h=L.get(`${s}:${t}`)?.data,E=L.get(`${s}:${t}`)?.lastUpdate,Q=i(s),z=!!(O&&h&&E&&Date.now()-E<b),H=z&&Q&&!M,v=l.useCallback(async()=>{if(!(!C||!D)){B(!0);try{const _=[];d&&_.push(Ce.getQuotes(C,t,s).then(k=>{k.status==="success"&&k.data&&p(k.data)}).catch(()=>{console.debug("REST quotes fetch failed")})),o&&u==="Depth"&&_.push(Ce.getDepth(C,t,s).then(k=>{k.status==="success"&&k.data&&S(k.data)}).catch(()=>{console.debug("REST depth fetch failed")})),await Promise.all(_),A.current=Date.now()}finally{B(!1)}}},[C,t,s,D,d,o,u]),w=l.useRef(n),q=l.useRef(D),K=l.useRef(v);l.useEffect(()=>{w.current=n,q.current=D,K.current=v},[n,D,v]),l.useEffect(()=>{if(!n||!D)return;K.current();const _=setInterval(()=>{w.current&&q.current&&K.current()},y);return()=>clearInterval(_)},[n,D,t,s,y]),l.useEffect(()=>{p(null),S(null)},[t,s]);const g=l.useMemo(()=>{if(j)return{buy:j.bids.map(_=>({price:_.price,quantity:_.quantity})),sell:j.asks.map(_=>({price:_.price,quantity:_.quantity}))}},[j]),P=l.useMemo(()=>{const _=h?.depth??g,k=h?.depth?.buy?.[0]?.price??g?.buy?.[0]?.price??h?.bid_price??a?.bid,Z=h?.depth?.sell?.[0]?.price??g?.sell?.[0]?.price??h?.ask_price??a?.ask,ie=h?.depth?.buy?.[0]?.quantity??g?.buy?.[0]?.quantity??h?.bid_size,W=h?.depth?.sell?.[0]?.quantity??g?.sell?.[0]?.quantity??h?.ask_size;return{ltp:h?.ltp??j?.ltp??a?.ltp,open:h?.open??j?.open??a?.open,high:h?.high??j?.high??a?.high,low:h?.low??j?.low??a?.low,close:h?.close??j?.prev_close??a?.prev_close,volume:h?.volume??j?.volume??a?.volume,oi:j?.oi??a?.oi,change:h?.change,changePercent:h?.change_percent,bidPrice:k,askPrice:Z,bidSize:ie,askSize:W,depth:_}},[h,a,j,g]),R=l.useMemo(()=>{if(P.change!==void 0)return P;const _=P.ltp&&P.close?P.ltp-P.close:void 0,k=_&&P.close?_/P.close*100:void 0;return{...P,change:_,changePercent:k}},[P]),J=l.useMemo(()=>z?"websocket":a||j?"rest":"none",[z,a,j]);return{data:R,isLive:H,isConnected:O,isLoading:U&&!a&&!j,isPaused:M,isFallbackMode:T,dataSource:J,refresh:v}}const Rs=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL-M",label:"SL-M"},{value:"SL",label:"SL-L"}],Is=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],Bs=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function fe(t,s){return s<=0?t:Number((Math.round(t/s)*s).toFixed(2))}function ge(t,s,r){const n=fe(t,s);return r==="up"?Number((n+s).toFixed(2)):Math.max(0,Number((n-s).toFixed(2)))}function Me(t){return["NFO","BFO","MCX","CDS","BCD","NCDEX"].includes(t)}function Vs({open:t,onOpenChange:s,symbol:r="",exchange:n="",action:u="BUY",quantity:d,lotSize:o=1,tickSize:b=.05,product:y="NRML",priceType:C="MARKET",strategy:i="OptionChain",onSuccess:a,onError:p}){const{apiKey:j}=we(),[S,U]=l.useState(u),[B,A]=l.useState(d??o),[D,x]=l.useState(C),[L,O]=l.useState(y),[M,T]=l.useState(0),[h,E]=l.useState(0),[Q,z]=l.useState(!1),[H,v]=l.useState(!1),[w,q]=l.useState("lots"),[K,g]=l.useState(1),P=Me(n)?Is:Bs,{data:R,isLoading:J,isConnected:_}=Fs(r,n,{enabled:t&&!!r&&!!n,mode:"Depth",useQuotesFallback:!0,useDepthFallback:!0});l.useEffect(()=>{if(t){U(u),A(d??o),x(C);const m=Me(n),N=m?"NRML":"CNC",pe=y&&(m?["NRML","MIS"]:["CNC","MIS"]).includes(y)?y:N;O(pe),T(0),E(0),v(!1),q("lots"),g(1)}},[t,u,d,o,C,y,n]);const k={ltp:R.ltp,close:R.close,change:R.change,change_percent:R.changePercent,bidPrice:R.bidPrice,askPrice:R.askPrice,bidSize:R.bidSize,askSize:R.askSize,depth:R.depth},Z=k.change,ie=k.change_percent;l.useEffect(()=>{D!=="MARKET"&&k.ltp&&M===0&&T(fe(k.ltp,b))},[D,k.ltp,M,b]);const W=D==="LIMIT"||D==="SL",X=D==="SL-M"||D==="SL",$=l.useCallback(()=>!(!r||!n||!j||B<=0||W&&M<=0||X&&h<=0),[r,n,j,B,W,M,X,h]),je=async()=>{if(!$()){ce.error("Please fill all required fields");return}if(!j){ce.error("API key not found. Please set up your API key."),p?.("API key not found");return}z(!0);try{const N={apikey:j,strategy:i,exchange:n,symbol:r,action:S,quantity:B,pricetype:D,product:L,...W&&{price:M},...X&&{trigger_price:h}},F=await Ce.placeOrder(N),pe=F.orderid;if(F.status==="success"&&pe)a?.(pe),s(!1);else{const ke=F.message||"Order placement failed";ce.error(ke,"orders"),p?.(ke)}}catch(m){let N="Order placement failed";if(m&&typeof m=="object"){const F=m;F.response?.data?.message?N=F.response.data.message:F.message&&(N=F.message)}ce.error(N,"orders"),p?.(N)}finally{z(!1)}},ee=m=>{const N=parseInt(m)||0;if(w==="lots")A(N*o),g(N);else{const F=Math.max(o,Math.round(N/o)*o);A(F),g(F/o)}},se=w==="lots"?K:B,c=J&&!k.ltp&&!_;return e.jsx(Ue,{open:t,onOpenChange:s,children:e.jsxs(Ae,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx(qe,{children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:S==="BUY"?"text-green-500":"text-red-500",children:S}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:r})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(_s,{exchange:n,ltp:k.ltp,prevClose:k.close,change:Z,changePercent:ie,bidPrice:k.bidPrice,askPrice:k.askPrice,bidSize:k.bidSize,askSize:k.askSize,isLoading:c}),e.jsx(Ms,{depth:k.depth,isExpanded:H,onToggle:()=>v(!H),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"button",variant:S==="BUY"?"default":"outline",className:f("flex-1",S==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>U("BUY"),children:"BUY"}),e.jsx(I,{type:"button",variant:S==="SELL"?"default":"outline",className:f("flex-1",S==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>U("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>q("lots"),className:f("px-2 py-0.5 text-[10px] rounded",w==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>q("shares"),className:f("px-2 py-0.5 text-[10px] rounded",w==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(ye,{type:"number",value:se,onChange:m=>ee(m.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",o]}),e.jsxs("span",{children:["Total qty: ",B]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price Type"}),e.jsxs(oe,{value:D,onValueChange:m=>x(m),children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsx(me,{children:Rs.map(m=>e.jsx(xe,{value:m.value,children:m.label},m.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Product"}),e.jsxs(oe,{value:L,onValueChange:m=>O(m),children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsx(me,{children:P.map(m=>e.jsx(xe,{value:m.value,children:m.label},m.value))})]})]})]}),W&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>T(ge(M,b,"down")),children:"-"}),e.jsx(ye,{type:"number",value:M,onChange:m=>T(parseFloat(m.target.value)||0),onBlur:()=>T(fe(M,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx(I,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>T(ge(M,b,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",b]})]}),X&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>E(ge(h,b,"down")),children:"-"}),e.jsx(ye,{type:"number",value:h,onChange:m=>E(parseFloat(m.target.value)||0),onBlur:()=>E(fe(h,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx(I,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>E(ge(h,b,"up")),children:"+"})]})]})]}),e.jsxs(Ye,{className:"gap-2 sm:gap-0",children:[e.jsx(I,{variant:"outline",onClick:()=>s(!1),disabled:Q,children:"Cancel"}),e.jsx(I,{onClick:je,disabled:!$()||Q,className:f(S==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:Q?"Placing...":`Place ${S} Order`})]})]})})}const Us=[{value:"NFO",label:"NFO"},{value:"BFO",label:"BFO"}],Fe={NFO:["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY"],BFO:["SENSEX","BANKEX"]},As=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function le(t){if(t==null||t===0)return"0";const s=t/1e5;if(s>=100)return s.toFixed(0)+"L";if(s>=10)return s.toFixed(1)+"L";if(s>=1)return s.toFixed(2)+"L";{const r=t/1e3;return r>=1?r.toFixed(1)+"K":t.toLocaleString()}}function G(t){return t==null?"0.00":t.toFixed(2)}function qs(t){if(!t)return"";const s=t.split("-");return s.length===3?`${s[0]}${s[1].toUpperCase()}${s[2].slice(-2)}`:t.replace(/-/g,"").toUpperCase()}function zs(t){let s=0,r=0;return t.forEach(n=>{n.ce?.oi&&(s+=n.ce.oi),n.pe?.oi&&(r+=n.pe?.oi??0)}),s===0?0:r/s}function Ys(t){let s=0,r=0,n=0,u=0;return t.forEach(d=>{d.ce&&(s+=d.ce.volume??0,n+=d.ce.oi??0),d.pe&&(r+=d.pe.volume??0,u+=d.pe.oi??0)}),{ceVolume:s,peVolume:r,ceOi:n,peOi:u}}function Qs(t,s){let r=0;return t.forEach(n=>{const u=s==="oi"?n.ce?.oi:n.ce?.volume,d=s==="oi"?n.pe?.oi:n.pe?.volume;u&&u>r&&(r=u),d&&d>r&&(r=d)}),r||1}const $s=$e.memo(function({strike:s,previousStrike:r,maxBarValue:n,visibleCeColumns:u,visiblePeColumns:d,barDataSource:o,barStyle:b,optionExchange:y,onPlaceOrder:C}){const i=s.ce,a=s.pe,p=i?.label??a?.label??"",j=p==="ATM",S=p.startsWith("OTM"),U=p.startsWith("ITM"),B=r?.ce?.ltp!==void 0&&r.ce.ltp!==i?.ltp,A=r?.pe?.ltp!==void 0&&r.pe.ltp!==a?.ltp,D=B?i&&r?.ce&&i.ltp>r.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",x=A?a&&r?.pe&&a.ltp>r.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",L=i&&i.bid>0&&i.ask>0?i.ask-i.bid:0,O=a&&a.bid>0&&a.ask>0?a.ask-a.bid:0,M=L<=1?"text-green-500":L<=2?"text-yellow-500":"text-red-500",T=O<=1?"text-green-500":O<=2?"text-yellow-500":"text-red-500",h=o==="oi"?i?.oi:i?.volume,E=o==="oi"?a?.oi:a?.volume,Q=h?Math.min(h/n*100,100):0,z=E?Math.min(E/n*100,100):0,H=b==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",v=b==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",w="font-mono tabular-nums text-xs",q=g=>{switch(g){case"ce_oi":return e.jsx("span",{className:w,children:le(i?.oi)});case"ce_volume":return e.jsx("span",{className:w,children:le(i?.volume)});case"ce_bid_qty":return e.jsx("span",{className:w,children:i?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:f(w,"text-red-500"),children:G(i?.bid)});case"ce_ltp":return e.jsx("span",{className:f(w,"font-semibold",D),children:G(i?.ltp)});case"ce_ask":return e.jsx("span",{className:f(w,"text-green-500"),children:G(i?.ask)});case"ce_ask_qty":return e.jsx("span",{className:w,children:i?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:f(w,M),children:G(L)});default:return null}},K=g=>{switch(g){case"pe_oi":return e.jsx("span",{className:w,children:le(a?.oi)});case"pe_volume":return e.jsx("span",{className:w,children:le(a?.volume)});case"pe_bid_qty":return e.jsx("span",{className:w,children:a?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:f(w,"text-red-500"),children:G(a?.bid)});case"pe_ltp":return e.jsx("span",{className:f(w,"font-semibold",x),children:G(a?.ltp)});case"pe_ask":return e.jsx("span",{className:f(w,"text-green-500"),children:G(a?.ask)});case"pe_ask_qty":return e.jsx("span",{className:w,children:a?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:f(w,T),children:G(O)});default:return null}};return e.jsxs(Se,{className:f("hover:bg-muted/50 relative group"),"data-strike":s.strike,"data-label":p,children:[u.length>0&&e.jsxs(ve,{className:f("p-0 relative",S&&!j&&"bg-amber-500/5"),children:[e.jsx("div",{className:f("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",H),style:{width:`${Q}%`}}),i&&e.jsxs("div",{className:f("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),C({symbol:i.symbol,exchange:y,action:"BUY",lotSize:i.lotsize??1,tickSize:i.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:g=>{g.stopPropagation(),C({symbol:i.symbol,exchange:y,action:"SELL",lotSize:i.lotsize??1,tickSize:i.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:u.map(g=>{const P=V.find(R=>R.key===g);return e.jsx("div",{className:f("flex-1 px-2 py-1.5 min-w-0",P?.align==="right"&&"text-right",P?.align==="center"&&"text-center",P?.align==="left"&&"text-left"),children:q(g)},g)})})]}),e.jsx(ve,{className:f("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",j?"bg-primary/15":"bg-muted/30"),children:s.strike}),d.length>0&&e.jsxs(ve,{className:f("p-0 relative",U&&!j&&"bg-amber-500/5"),children:[e.jsx("div",{className:f("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",v),style:{width:`${z}%`}}),a&&e.jsxs("div",{className:f("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),C({symbol:a.symbol,exchange:y,action:"BUY",lotSize:a.lotsize??1,tickSize:a.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:g=>{g.stopPropagation(),C({symbol:a.symbol,exchange:y,action:"SELL",lotSize:a.lotsize??1,tickSize:a.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:d.map(g=>{const P=V.find(R=>R.key===g);return e.jsx("div",{className:f("flex-1 px-2 py-1.5 min-w-0",P?.align==="right"&&"text-right",P?.align==="center"&&"text-center",P?.align==="left"&&"text-left"),children:K(g)},g)})})]})]})});function mt(){const{apiKey:t}=we(),{visibleColumns:s,columnOrder:r,strikeCount:n,selectedUnderlying:u,barDataSource:d,barStyle:o,toggleColumn:b,reorderColumns:y,setStrikeCount:C,setSelectedUnderlying:i,setBarDataSource:a,setBarStyle:p,resetToDefaults:j}=Os(),[S,U]=l.useState("NFO"),[B,A]=l.useState(Fe.NFO),[D,x]=l.useState(!1),[L,O]=l.useState(""),[M,T]=l.useState([]),h=l.useRef(new Map),[E,Q]=l.useState(null),z=S,H=S,{data:v,isConnected:w,isStreaming:q,isPaused:K,error:g,lastUpdate:P,refetch:R,isLoading:J,streamingSymbols:_}=Ge(t,u,H,z,qs(L),n,{enabled:!!L,oiRefreshInterval:3e4,pauseWhenHidden:!0});l.useEffect(()=>{const c=Fe[S]||[];A(c),i(c[0]||""),T([]),O("");let m=!1;return(async()=>{try{const F=await Le.getUnderlyings(S);if(m)return;F.status==="success"&&F.underlyings.length>0&&(A(F.underlyings),F.underlyings.includes(c[0])||i(F.underlyings[0]))}catch{}})(),()=>{m=!0}},[S]),l.useEffect(()=>{if(!u)return;T([]),O("");let c=!1;return(async()=>{try{const N=await Le.getExpiries(S,u);if(c)return;N.status==="success"&&N.expiries.length>0?(T(N.expiries),O(N.expiries[0])):(T([]),O(""))}catch{if(c)return;ce.error("Failed to load expiry dates")}})(),()=>{c=!0}},[u]),l.useEffect(()=>{if(v?.chain){const c=setTimeout(()=>{const m=new Map;v.chain.forEach(N=>{m.set(N.strike,N)}),h.current=m},100);return()=>clearTimeout(c)}},[v?.chain]);const k=c=>{i(c),O(""),T([])},Z=()=>{R()},ie=l.useCallback(c=>{Q({open:!0,symbol:c.symbol,exchange:c.exchange,action:c.action,quantity:c.lotSize,lotSize:c.lotSize,tickSize:c.tickSize})},[]),W=l.useCallback(c=>{c||Q(null)},[]),X=l.useMemo(()=>v?.chain?zs(v.chain):0,[v?.chain]),$=l.useMemo(()=>v?.chain?Ys(v.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[v?.chain]),je=l.useMemo(()=>v?.chain?Qs(v.chain,d):1,[v?.chain,d]),ee=l.useMemo(()=>r.filter(c=>V.find(N=>N.key===c)?.side==="ce"&&s.includes(c)),[r,s]),se=l.useMemo(()=>r.filter(c=>V.find(N=>N.key===c)?.side==="pe"&&s.includes(c)),[r,s]);return g?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(ae,{className:"max-w-md",children:e.jsx(re,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:g}),e.jsxs(I,{onClick:Z,className:"mt-4",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(oe,{value:S,onValueChange:U,children:[e.jsx(de,{className:"w-24",children:e.jsx(ue,{placeholder:"Exchange"})}),e.jsx(me,{children:Us.map(c=>e.jsx(xe,{value:c.value,children:c.label},c.value))})]}),e.jsxs(ms,{open:D,onOpenChange:x,children:[e.jsx(xs,{asChild:!0,children:e.jsxs(I,{variant:"outline",role:"combobox","aria-expanded":D,className:"w-36 justify-between",children:[u||"Select Underlying",e.jsx(es,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ps,{className:"w-48 p-0",align:"start",children:e.jsxs(hs,{children:[e.jsx(gs,{placeholder:"Search underlying..."}),e.jsxs(fs,{children:[e.jsx(bs,{children:"No underlying found"}),e.jsx(js,{children:B.map(c=>e.jsxs(ys,{value:c,onSelect:()=>{k(c),x(!1)},children:[e.jsx(ss,{className:`mr-2 h-4 w-4 ${u===c?"opacity-100":"opacity-0"}`}),c]},c))})]})]})})]}),e.jsxs(oe,{value:L,onValueChange:O,disabled:M.length===0,children:[e.jsx(de,{className:"w-36",children:e.jsx(ue,{placeholder:"Select Expiry"})}),e.jsx(me,{children:M.map(c=>e.jsx(xe,{value:c,children:c},c))})]}),e.jsxs(oe,{value:String(n),onValueChange:c=>C(Number(c)),children:[e.jsx(de,{className:"w-36",children:e.jsx(ue,{placeholder:"Strike Count"})}),e.jsx(me,{children:As.map(c=>e.jsx(xe,{value:String(c.value),children:c.label},c.value))})]}),e.jsx(Ls,{barDataSource:d,barStyle:o,onBarDataSourceChange:a,onBarStyleChange:p}),e.jsx(Ps,{visibleColumns:s,onToggleColumn:b,onResetToDefaults:j}),e.jsx(Ts,{columnOrder:r,visibleColumns:s,onReorderColumns:y}),e.jsxs(I,{onClick:Z,disabled:!L||J,children:[e.jsx(Pe,{className:`h-4 w-4 mr-2 ${J?"animate-spin":""}`}),"Refresh"]})]})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[u," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:G(v.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",G(v.underlying_prev_close)]})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:v.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",v.expiry_date]})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${X>1?"text-green-500":"text-yellow-500"}`,children:X.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono tabular-nums",children:le($.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono tabular-nums",children:le($.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:$.ceOi+$.peOi>0?`${$.ceOi/($.ceOi+$.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",X.toFixed(2)]})})]})})]}),e.jsx(ae,{children:e.jsx(re,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(vs,{className:"w-full table-fixed",children:[e.jsxs(Ns,{children:[e.jsxs(Se,{className:"bg-muted/30 border-b-0",children:[ee.length>0&&e.jsx(ne,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(ne,{className:"text-center w-20 min-w-20"}),se.length>0&&e.jsx(ne,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(Se,{className:"bg-muted/50",children:[ee.length>0&&e.jsx(ne,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:ee.map(c=>{const m=V.find(N=>N.key===c);return e.jsx("div",{className:f("flex-1 px-2 py-2 text-xs font-medium min-w-0",m?.align==="right"&&"text-right",m?.align==="center"&&"text-center",m?.align==="left"&&"text-left"),children:m?.label},c)})})}),e.jsx(ne,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),se.length>0&&e.jsx(ne,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:se.map(c=>{const m=V.find(N=>N.key===c);return e.jsx("div",{className:f("flex-1 px-2 py-2 text-xs font-medium min-w-0",m?.align==="right"&&"text-right",m?.align==="center"&&"text-center",m?.align==="left"&&"text-left"),children:m?.label},c)})})})]})]}),e.jsx(Cs,{children:v.chain.map(c=>e.jsx($s,{strike:c,previousStrike:h.current.get(c.strike),maxBarValue:je,visibleCeColumns:ee,visiblePeColumns:se,barDataSource:d,barStyle:o,optionExchange:z,onPlaceOrder:ie},c.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[q?e.jsx(ts,{className:"h-4 w-4 text-green-500"}):e.jsx(as,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Ve,{variant:q?"default":w?"secondary":"destructive",children:K?"Paused":q?`Streaming ${_} symbols`:w?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",d==="oi"?"OI":"Volume"," (",o,")"]})]}),e.jsxs("div",{children:["Last Update: ",P?P.toLocaleTimeString():"-"]})]})]}),!v&&!g&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Vs,{open:E?.open??!1,onOpenChange:W,symbol:E?.symbol,exchange:E?.exchange,action:E?.action,quantity:E?.quantity,lotSize:E?.lotSize,tickSize:E?.tickSize,strategy:"OptionChain"})]})}export{mt as default};
