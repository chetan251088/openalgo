import{r as c,j as e}from"./vendor-react-BsSNOS8Q.js";import{t as u}from"./tomic-BBQMDcLq.js";import{s as O,B as j,e as C}from"./index-Dy6kfXgl.js";import{C as l,a as i,b as n,c as p,d as r}from"./card-DHzxBmRO.js";import{T as se,a as te,b as A,c as R,d as ae,e as y}from"./table-CjGevsr5.js";import{am as le,R as ie,a9 as B,aV as ne,aD as re,aW as de}from"./vendor-icons-BJR3KiwM.js";import{L as ce}from"./vendor-router-b1Q1Drqs.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-DB8xhlcH.js";function a(m){return m==null||Number.isNaN(m)?"—":m.toLocaleString("en-IN",{maximumFractionDigits:2})}function T(m,_){if(!m)return null;const g=new Map;for(const[f,d]of Object.entries(m))g.set(f.toLowerCase(),d);for(const f of _){const d=g.get(f.toLowerCase());if(typeof d=="number"&&Number.isFinite(d))return d}return null}const oe=[{label:"Dashboard",href:"/tomic/dashboard"},{label:"Agents",href:"/tomic/agents"},{label:"Risk",href:"/tomic/risk"}],xe=[{label:"Status JSON",href:"/tomic/status"},{label:"Positions JSON",href:"/tomic/positions"},{label:"Journal JSON",href:"/tomic/journal"},{label:"Analytics JSON",href:"/tomic/analytics"},{label:"Metrics JSON",href:"/tomic/metrics"},{label:"Signal Quality JSON",href:"/tomic/signals/quality"},{label:"Audit JSON",href:"/tomic/audit"}];function ve(){const[m,_]=c.useState(!0),[g,f]=c.useState(!1),[d,P]=c.useState(null),[J,$]=c.useState(null),[H,Q]=c.useState(null),[S,G]=c.useState(null),[b,U]=c.useState(null),N=c.useCallback(async(s=!1)=>{s?f(!0):_(!0);try{const[t,M,q,F]=await Promise.allSettled([u.getStatus(),u.getPositions(),u.getAnalytics(),u.getSignalQuality(!1)]);t.status==="fulfilled"&&$(t.value),M.status==="fulfilled"&&Q(M.value),q.status==="fulfilled"&&G(q.value),F.status==="fulfilled"&&U(F.value)}catch{s||O.error("Failed to load TOMIC dashboard","monitoring")}finally{s?f(!1):_(!1)}},[]);c.useEffect(()=>{N(!1);const s=setInterval(()=>{N(!0)},5e3);return()=>clearInterval(s)},[N]);const w=c.useCallback(async s=>{P(s);try{s==="start"&&await u.start(),s==="pause"&&await u.pause("Paused from dashboard"),s==="resume"&&await u.resume(),s==="stop"&&await u.stop(),O.success(`TOMIC ${s} requested`,"monitoring"),await N(!0)}catch{O.error(`Failed to ${s} TOMIC`,"monitoring")}finally{P(null)}},[N]),x=J?.data,h=x?.signal_loop,I=c.useMemo(()=>Object.entries(x?.agents??{}),[x?.agents]),k=H?.positions??[],L=c.useMemo(()=>k.reduce((s,t)=>s+(Number(t.pnl)||0),0),[k]),W=T(S?.metrics,["expectancy","expectancy_30","rolling_expectancy"]),z=T(S?.metrics,["win_rate","winrate"]),K=T(S?.metrics,["max_drawdown","max_dd"]),V=T(S?.metrics,["sharpe","sharpe_ratio"]),o=b?.data?.signals,v=b?.data?.feed?.ws??{},X=b?.data?.feed?.bridge??{},D=b?.data?.diagnostics?.no_action_reasons??[],Y=!!v.connected,Z=v.authenticated==null?!0:!!v.authenticated,E=Y&&Z,ee=Number(X.last_tick_age_s??-1);return m?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(le,{className:"h-6 w-6"}),"TOMIC Dashboard"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Runtime health, queue state, and high-level performance."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>{N(!0)},disabled:g,children:[e.jsx(ie,{className:`h-4 w-4 mr-2 ${g?"animate-spin":""}`}),"Refresh"]}),e.jsxs(j,{onClick:()=>{w("start")},disabled:d!==null,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),d==="start"?"Starting...":"Start"]}),e.jsxs(j,{variant:"secondary",onClick:()=>{w("pause")},disabled:d!==null,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),d==="pause"?"Pausing...":"Pause"]}),e.jsxs(j,{variant:"secondary",onClick:()=>{w("resume")},disabled:d!==null,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),d==="resume"?"Resuming...":"Resume"]}),e.jsxs(j,{variant:"destructive",onClick:()=>{w("stop")},disabled:d!==null,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),d==="stop"?"Stopping...":"Stop"]})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(n,{children:"TOMIC Routes"}),e.jsx(p,{children:"Quick navigation for all dashboard pages and read-only JSON endpoints."})]}),e.jsxs(r,{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:oe.map(s=>e.jsx(j,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(ce,{to:s.href,children:s.label})},s.href))}),e.jsx("div",{className:"flex flex-wrap gap-2",children:xe.map(s=>e.jsx(j,{asChild:!0,variant:"secondary",size:"sm",children:e.jsx("a",{href:s.href,target:"_blank",rel:"noreferrer",children:s.label})},s.href))}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Control routes are POST-only and mapped to the action buttons above:",e.jsx("code",{className:"ml-1",children:"/tomic/start"}),",",e.jsx("code",{className:"ml-1",children:"/tomic/pause"}),",",e.jsx("code",{className:"ml-1",children:"/tomic/resume"}),",",e.jsx("code",{className:"ml-1",children:"/tomic/stop"}),"."]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Runtime"})}),e.jsxs(r,{className:"space-y-1",children:[e.jsx(C,{variant:x?.running?"default":"secondary",children:x?.running?"RUNNING":"OFFLINE"}),x?.killed&&e.jsxs("div",{className:"text-xs text-red-500 flex items-center gap-1",children:[e.jsx(de,{className:"h-3.5 w-3.5"}),"Kill switch active"]})]})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Queue Pending"})}),e.jsx(r,{children:e.jsx("p",{className:"text-2xl font-bold",children:a(x?.command_queue_pending??0)})})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Dead Letters"})}),e.jsx(r,{children:e.jsx("p",{className:`text-2xl font-bold ${(x?.command_dead_letters??0)>0?"text-red-500":""}`,children:a(x?.command_dead_letters??0)})})]}),e.jsxs(l,{children:[e.jsxs(i,{className:"pb-2",children:[e.jsx(n,{className:"text-sm",children:"Open Positions"}),e.jsxs(p,{children:["Net P&L: ",L>=0?"+":"",a(L)]})]}),e.jsx(r,{children:e.jsx("p",{className:"text-2xl font-bold",children:a(k.length)})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(i,{className:"pb-2",children:[e.jsx(n,{className:"text-sm",children:"Signal Loop"}),e.jsx(p,{children:h?.enabled?"Enabled":"Disabled"})]}),e.jsxs(r,{className:"space-y-1",children:[e.jsx(C,{variant:h?.running?"default":"secondary",children:h?.running?"RUNNING":"STOPPED"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["interval: ",a(h?.interval_s),"s"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["cooldown: ",a(h?.enqueue_cooldown_s),"s"]})]})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Signals Routed"})}),e.jsx(r,{children:e.jsx("p",{className:"text-2xl font-bold",children:a(o?.routed_count??0)})})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Enqueued This Cycle"})}),e.jsxs(r,{children:[e.jsx("p",{className:"text-2xl font-bold",children:a(o?.enqueued_count??h?.last_enqueued??0)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["dedupe skips: ",a(o?.dedupe_skipped_count??h?.last_dedupe_skips??0)]})]})]}),e.jsxs(l,{children:[e.jsxs(i,{className:"pb-2",children:[e.jsx(n,{className:"text-sm",children:"Feed Health"}),e.jsxs(p,{children:["tick age: ",a(ee),"s"]})]}),e.jsx(r,{children:e.jsx(C,{variant:E?"default":"destructive",children:E?"LIVE":"STALE/OFFLINE"})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Expectancy"})}),e.jsx(r,{children:e.jsx("p",{className:"text-xl font-semibold",children:a(W)})})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Win Rate %"})}),e.jsx(r,{children:e.jsx("p",{className:"text-xl font-semibold",children:a(z)})})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Max Drawdown"})}),e.jsx(r,{children:e.jsx("p",{className:"text-xl font-semibold",children:a(K)})})]}),e.jsxs(l,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(n,{className:"text-sm",children:"Sharpe"})}),e.jsx(r,{children:e.jsx("p",{className:"text-xl font-semibold",children:a(V)})})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(n,{children:"Signal Quality"}),e.jsxs(p,{children:["Generated: ",b?.data?.generated_at||"—"," | Accept rate: ",a(o?.routed_accept_rate_pct),"%"]})]}),e.jsxs(r,{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Top Routed"}),(o?.top_routed??[]).slice(0,5).map((s,t)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[String(s.instrument??"—")," | ",String(s.strategy_type??"—")," | ",String(s.direction??"—")]},`routed-${t}`)),(o?.top_routed??[]).length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No routed signals yet."})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Top Sniper"}),(o?.top_sniper??[]).slice(0,5).map((s,t)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[String(s.instrument??"—")," | ",String(s.pattern??"—")," | ",String(s.direction??"—")]},`sniper-${t}`)),(o?.top_sniper??[]).length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No sniper signals yet."})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Top Volatility"}),(o?.top_volatility??[]).slice(0,5).map((s,t)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[String(s.underlying??"—")," | ",String(s.strategy_type??"—")," | ",String(s.direction??"—")]},`vol-${t}`)),(o?.top_volatility??[]).length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No volatility signals yet."})]})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(n,{children:"Why No Action"}),e.jsx(p,{children:"Real-time blockers from feed, router, and risk pipeline."})]}),e.jsxs(r,{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ws_auth_status: ",String(v.last_auth_status??"—")," | ws_auth_message: ",String(v.last_auth_message??"—")]}),D.map((s,t)=>e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t+1,". ",s]},`${s}-${t}`)),D.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"No blocking reason recorded in latest cycle."})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(n,{children:"Agent Health"}),e.jsx(p,{children:"Heartbeat and restart counters from Supervisor."})]}),e.jsx(r,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(A,{children:[e.jsx(R,{children:"Agent"}),e.jsx(R,{children:"Status"}),e.jsx(R,{children:"Last Heartbeat (s)"}),e.jsx(R,{children:"Restarts"})]})}),e.jsxs(ae,{children:[I.map(([s,t])=>e.jsxs(A,{children:[e.jsx(y,{className:"font-medium",children:s}),e.jsx(y,{children:e.jsx(C,{variant:t.running?"default":"secondary",children:t.running?t.paused?"PAUSED":"RUNNING":"STOPPED"})}),e.jsx(y,{children:a(t.last_heartbeat_ago_s)}),e.jsx(y,{children:a(t.restarts)})]},s)),I.length===0&&e.jsx(A,{children:e.jsx(y,{colSpan:4,className:"text-muted-foreground",children:"No agent status data available."})})]})]})})})]})]})}export{ve as default};
