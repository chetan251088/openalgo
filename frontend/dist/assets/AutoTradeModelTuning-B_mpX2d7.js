import{r as a,j as e}from"./vendor-react-CCyQGCED.js";import{t as d,B as S,e as T}from"./index-C6mW-S7J.js";import{f as pe,a as je,r as de,b as fe}from"./ai-scalper-BCssOHnB.js";import{C as _,a as C,b as w,d as R}from"./card-DSoAFolw.js";import{I as j}from"./input-QT7OR2Db.js";import{S as i,a as c,b as o,c as u,d as r}from"./select-CFgpE2WL.js";import{T as ge,a as ve,b as F,c as f,d as ye,e as p}from"./table-Cb3YYl5l.js";import{Y as Ne,aQ as be,k as Se,as as Te}from"./vendor-icons-CCn_k3dF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";const _e=[{label:"OpenAI",value:"openai"},{label:"Anthropic",value:"anthropic"},{label:"Ollama (Local)",value:"ollama"}],Ce=[{label:"Off",value:"off"},{label:"Interval",value:"interval"},{label:"Daily",value:"daily"}],we=[{label:"Auto (use current)",value:"AUTO"},{label:"NIFTY",value:"NIFTY"},{label:"SENSEX",value:"SENSEX"}];function E(l){if(!l)return"--";const g=new Date(l);return Number.isNaN(g.getTime())?l:g.toLocaleString("en-IN")}function ie(l){return l==null?"--":typeof l=="number"?Number.isInteger(l)?l.toString():l.toFixed(2):String(l)}function He(){const[l,g]=a.useState(null),[v,ce]=a.useState([]),[O,I]=a.useState(!1),[M,x]=a.useState(!1),[P,V]=a.useState(!0),[U,L]=a.useState("openai"),[H,k]=a.useState(""),[B,D]=a.useState(""),[Y,X]=a.useState(!0),[$,q]=a.useState(!0),[G,Q]=a.useState("30"),[z,J]=a.useState(!1),[K,W]=a.useState(!1),[Z,ee]=a.useState("AUTO"),[m,y]=a.useState("off"),[se,ae]=a.useState("30"),[le,te]=a.useState("20:00"),ne=a.useRef(!1),n=a.useMemo(()=>l?.last_run??v[0],[l,v]),oe=l?.current??{},ue=l?.paper_mode===void 0||l?.paper_mode===null?"--":l.paper_mode?"Paper":"Live",h=a.useCallback(async()=>{I(!0);try{const s=await pe();if(g(s),!ne.current){V(s.enabled),L(s.provider||"openai"),k(s.model??""),D(s.base_url??""),X(s.auto_apply_paper),q(s.apply_clamps),Q(String(s.min_trades??30)),J(s.notify_email),W(s.notify_telegram),ee(s.underlying??"AUTO");const t=s.schedule??{enabled:!1};if(!t.enabled)y("off");else if(t.type==="daily")y("daily"),te(t.time_of_day??"20:00");else{y("interval");const b=t.interval_s?Math.max(1,Math.round(t.interval_s/60)):30;ae(String(b))}ne.current=!0}}catch(s){console.error("Failed to load model tuning status",s),d.error("Failed to load model tuning status")}finally{I(!1)}},[]),N=a.useCallback(async()=>{try{const s=await je(20);ce(s.runs??[])}catch(s){console.error("Failed to load model tuning runs",s),d.error("Failed to load model tuning runs")}},[]);a.useEffect(()=>{h(),N()},[h,N]);const re=s=>{const t=Number.parseInt(se,10),b=Number.parseInt(G,10);return{enabled:P,provider:U,model:H||void 0,base_url:B||void 0,auto_apply_paper:Y,apply_clamps:$,min_trades:Number.isFinite(b)?b:30,notify_email:z,notify_telegram:K,underlying:Z,schedule_type:m,interval_s:m==="interval"&&Number.isFinite(t)?t*60:void 0,time_of_day:m==="daily"?le:void 0,run_now:s}},xe=async()=>{x(!0);try{const s=await de(re(!0));s.status!=="success"?d.error(s.message||"Failed to run model tuning"):d.success("Model tuning queued"),await h(),await N()}catch(s){console.error("Failed to run model tuning",s),d.error("Failed to run model tuning")}finally{x(!1)}},me=async()=>{x(!0);try{const s=await de(re(!1));s.status!=="success"?d.error(s.message||"Failed to update schedule"):d.success("Model tuning schedule updated"),await h()}catch(s){console.error("Failed to save schedule",s),d.error("Failed to update schedule")}finally{x(!1)}},he=async s=>{if(s){x(!0);try{const t=await fe(s);t.status!=="success"?d.error(t.message||"Failed to apply recommendation"):d.success("Recommendation applied"),await h(),await N()}catch(t){console.error("Failed to apply recommendation",t),d.error("Failed to apply recommendation")}finally{x(!1)}}},A=Object.entries(n?.recommendations??{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"AutoTrade Model Tuning"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use cloud models to score performance and suggest safer parameter improvements."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(S,{variant:"secondary",onClick:h,disabled:O,children:[e.jsx(Ne,{className:`mr-2 h-4 w-4 ${O?"animate-spin":""}`}),"Refresh"]}),e.jsxs(S,{onClick:xe,disabled:M,children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Run Tuning"]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(_,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center gap-2 text-base",children:[e.jsx(Se,{className:"h-4 w-4"}),"Model Settings"]})}),e.jsxs(R,{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enabled"}),e.jsxs(i,{value:P?"on":"off",onValueChange:s=>V(s==="on"),children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Enabled"})}),e.jsxs(u,{children:[e.jsx(r,{value:"on",children:"On"}),e.jsx(r,{value:"off",children:"Off"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Provider"}),e.jsxs(i,{value:U,onValueChange:L,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Provider"})}),e.jsx(u,{children:_e.map(s=>e.jsx(r,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Model"}),e.jsx(j,{value:H,onChange:s=>k(s.target.value),placeholder:"gpt-4o-mini / claude-3-5-haiku"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Base URL (optional)"}),e.jsx(j,{value:B,onChange:s=>D(s.target.value),placeholder:"http://127.0.0.1:11434"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Min Trades"}),e.jsx(j,{value:G,onChange:s=>Q(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Auto-Apply (Paper)"}),e.jsxs(i,{value:Y?"on":"off",onValueChange:s=>X(s==="on"),children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Auto apply"})}),e.jsxs(u,{children:[e.jsx(r,{value:"on",children:"On"}),e.jsx(r,{value:"off",children:"Off"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Safety Clamps"}),e.jsxs(i,{value:$?"on":"off",onValueChange:s=>q(s==="on"),children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Clamps"})}),e.jsxs(u,{children:[e.jsx(r,{value:"on",children:"On"}),e.jsx(r,{value:"off",children:"Off"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Notify Email"}),e.jsxs(i,{value:z?"on":"off",onValueChange:s=>J(s==="on"),children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Email notify"})}),e.jsxs(u,{children:[e.jsx(r,{value:"on",children:"On"}),e.jsx(r,{value:"off",children:"Off"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Notify Telegram"}),e.jsxs(i,{value:K?"on":"off",onValueChange:s=>W(s==="on"),children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Telegram notify"})}),e.jsxs(u,{children:[e.jsx(r,{value:"on",children:"On"}),e.jsx(r,{value:"off",children:"Off"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Underlying Preset"}),e.jsxs(i,{value:Z,onValueChange:ee,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Underlying preset"})}),e.jsx(u,{children:we.map(s=>e.jsx(r,{value:s.value,children:s.label},s.value))})]})]})]})]}),e.jsxs(_,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center gap-2 text-base",children:[e.jsx(Te,{className:"h-4 w-4"}),"Schedule"]})}),e.jsxs(R,{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Schedule Type"}),e.jsxs(i,{value:m,onValueChange:y,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Schedule"})}),e.jsx(u,{children:Ce.map(s=>e.jsx(r,{value:s.value,children:s.label},s.value))})]})]}),m==="interval"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Interval (mins)"}),e.jsx(j,{value:se,onChange:s=>ae(s.target.value)})]}),m==="daily"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Time (HH:MM)"}),e.jsx(j,{value:le,onChange:s=>te(s.target.value)})]}),e.jsxs("div",{className:"flex items-end gap-2 md:col-span-2",children:[e.jsx(S,{variant:"secondary",onClick:me,disabled:M,children:"Save Schedule"}),l?.schedule?.enabled&&e.jsxs(T,{variant:"secondary",children:["Next: ",E(l.schedule.next_run_time??void 0)]})]})]})]})]}),e.jsxs(_,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between",children:[e.jsx(w,{className:"text-base",children:"Latest Recommendation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[n?.status&&e.jsx(T,{variant:"secondary",children:n.status}),n?.score!==null&&n?.score!==void 0&&e.jsxs(T,{variant:"secondary",children:["Score ",n.score]})]})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Run: ",E(n?.created_iso)]}),e.jsxs("span",{children:["Provider: ",n?.provider??"--"]}),e.jsxs("span",{children:["Mode: ",ue]})]}),e.jsx("div",{className:"text-sm",children:n?.notes||"No notes provided."}),e.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:A.length?A.map(([s,t])=>e.jsxs("div",{className:"rounded-md border border-border px-3 py-2 text-sm",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:s}),e.jsxs("div",{className:"font-medium",children:[ie(oe[s])," â†’ ",ie(t)]})]},s)):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No recommendations yet."})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{onClick:()=>he(n?.run_id),disabled:!n?.run_id||n?.applied||M||!A.length,children:"Apply Recommendation"}),n?.applied&&e.jsxs(T,{className:"bg-emerald-500/20 text-emerald-200 hover:bg-emerald-500/20",children:["Applied ",E(n.applied_iso??void 0)]})]})]})]}),e.jsxs(_,{children:[e.jsx(C,{children:e.jsx(w,{className:"text-base",children:"Run History"})}),e.jsx(R,{children:e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsxs(F,{children:[e.jsx(f,{children:"Time"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Score"}),e.jsx(f,{children:"Applied"}),e.jsx(f,{children:"Notes"})]})}),e.jsx(ye,{children:v.length?v.map(s=>e.jsxs(F,{children:[e.jsx(p,{children:E(s.created_iso)}),e.jsx(p,{children:s.status}),e.jsx(p,{children:s.score??"--"}),e.jsx(p,{children:s.applied?"Yes":"No"}),e.jsx(p,{className:"max-w-[320px] truncate",children:s.error?`Error: ${s.error}`:s.notes||"--"})]},s.run_id)):e.jsx(F,{children:e.jsx(p,{colSpan:5,className:"text-center text-sm text-muted-foreground",children:"No tuning runs yet."})})})]})})]})]})}export{He as default};
