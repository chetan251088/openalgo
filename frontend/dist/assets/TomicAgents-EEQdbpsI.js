import{r as x,j as e}from"./vendor-react-BsSNOS8Q.js";import{t as R}from"./tomic-DyI-gV4C.js";import{s as J,B as X,e as w}from"./index-pkdFY1Bt.js";import{C as u,a as h,b as m,c as j,d as g}from"./card-CQoVF7GG.js";import{T as v,a as b,b as a,c as i,d as y,e as n}from"./table-0IrsMSFl.js";import{aX as Y,R as Z}from"./vendor-icons-BJR3KiwM.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-b1Q1Drqs.js";import"./vendor-radix-DB8xhlcH.js";function t(d){return d==null?"—":typeof d=="string"?d:typeof d=="number"||typeof d=="boolean"?String(d):"—"}function K(d){if(typeof d=="number"&&Number.isFinite(d))return d;if(typeof d=="string"){const c=Number(d);if(Number.isFinite(c))return c}return null}function k(d){if(typeof d!="string"||d.length===0)return"—";const c=new Date(d);return Number.isNaN(c.getTime())?d:c.toLocaleString()}function S(d,c=2){const p=K(d);return p==null?"—":p.toFixed(c)}function ce(){const[d,c]=x.useState(!0),[p,T]=x.useState(!1),[C,Q]=x.useState(null),[A,U]=x.useState([]),[I,W]=x.useState([]),[l,G]=x.useState(null),_=x.useCallback(async(s=!1)=>{s?T(!0):c(!0);try{const[r,o,z,M]=await Promise.allSettled([R.getStatus(),R.getJournal(60),R.getAudit(80),R.getSignalQuality(!1)]);r.status==="fulfilled"&&Q(r.value),o.status==="fulfilled"&&U(o.value.trades??[]),z.status==="fulfilled"&&W(z.value.entries??[]),M.status==="fulfilled"&&G(M.value)}catch{s||J.error("Failed to load TOMIC agent view","monitoring")}finally{s?T(!1):c(!1)}},[]);x.useEffect(()=>{_(!1);const s=setInterval(()=>{_(!0)},6e3);return()=>clearInterval(s)},[_]);const $=x.useMemo(()=>Object.entries(C?.data?.agents??{}),[C?.data?.agents]),D=l?.data?.signals?.decision_breakdown??{},O=l?.data?.signals?.top_routed??[],E=l?.data?.signals?.enqueued_keys??[],F=l?.data?.signals?.router_decisions??[],q=l?.data?.router?.blocking_reasons??{},B=l?.data?.diagnostics?.no_action_reasons??[],f=l?.data?.feed?.ws??{},L=l?.data?.risk?.recent_evaluations??[],N=l?.data?.risk?.counters??{},P=l?.data?.agent_inputs?.sniper_readiness??[],H=l?.data?.agent_inputs?.volatility_readiness??[],V=l?.data?.agent_inputs?.volatility_snapshots??[];return d?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Y,{className:"h-6 w-6"}),"TOMIC Agents"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Live health, decision traces, and control audit entries."})]}),e.jsxs(X,{variant:"outline",onClick:()=>{_(!0)},disabled:p,children:[e.jsx(Z,{className:`h-4 w-4 mr-2 ${p?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsx(m,{children:"Agent Health Matrix"}),e.jsx(j,{children:"Supervisor heartbeat monitor across all agents."})]}),e.jsx(g,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(a,{children:[e.jsx(i,{children:"Agent"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Paused"}),e.jsx(i,{children:"Heartbeat (s)"}),e.jsx(i,{children:"Restarts"})]})}),e.jsxs(y,{children:[$.map(([s,r])=>e.jsxs(a,{children:[e.jsx(n,{className:"font-medium",children:s}),e.jsx(n,{children:e.jsx(w,{variant:r.running?"default":"secondary",children:r.running?"RUNNING":"STOPPED"})}),e.jsx(n,{children:r.paused?"Yes":"No"}),e.jsx(n,{children:r.last_heartbeat_ago_s.toFixed(1)}),e.jsx(n,{children:r.restarts})]},s)),$.length===0&&e.jsx(a,{children:e.jsx(n,{colSpan:5,className:"text-muted-foreground",children:"No agent telemetry available."})})]})]})})})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsx(m,{children:"Signal Router Snapshot"}),e.jsxs(j,{children:["Last generated: ",l?.data?.generated_at||"—"]})]}),e.jsxs(g,{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Decision Breakdown"}),Object.entries(D).map(([s,r])=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s,": ",String(r)]},s)),Object.keys(D).length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No router decisions yet."})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Top Routed"}),O.slice(0,6).map((s,r)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[String(s.instrument??"—")," | ",String(s.strategy_type??"—")," | ",String(s.direction??"—")]},`route-${r}`)),O.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No routed entries yet."})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Recent Enqueued Keys"}),E.slice(0,6).map((s,r)=>e.jsx("div",{className:"text-xs text-muted-foreground",children:String(s)},`${s}-${r}`)),E.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No auto-enqueue this cycle."})]})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsx(m,{children:"Live Pipeline Debug"}),e.jsx(j,{children:"Feed auth state, block reasons, and why no action happened."})]}),e.jsxs(g,{className:"grid gap-4 xl:grid-cols-3",children:[e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Feed WS Status"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["connected: ",t(f.connected)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["authenticated: ",t(f.authenticated)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["last_auth_status: ",t(f.last_auth_status)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["last_auth_message: ",t(f.last_auth_message)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["last_error: ",t(f.last_error)]})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Router Blocking Reasons"}),Object.entries(q).map(([s,r])=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r,"x - ",s]},s)),Object.keys(q).length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No router blocks this cycle."})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No-Action Reasons"}),B.map((s,r)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r+1,". ",s]},`${s}-${r}`)),B.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No blocking reason recorded."})]})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsx(m,{children:"Router Decisions (Latest Cycle)"}),e.jsx(j,{children:"Every routed/deferred/rejected decision with reason."})]}),e.jsx(g,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(a,{children:[e.jsx(i,{children:"Source"}),e.jsx(i,{children:"Instrument"}),e.jsx(i,{children:"Strategy"}),e.jsx(i,{children:"Action"}),e.jsx(i,{children:"Priority"}),e.jsx(i,{children:"Reason"})]})}),e.jsxs(y,{children:[F.slice(0,40).map((s,r)=>e.jsxs(a,{children:[e.jsx(n,{children:t(s.source)}),e.jsx(n,{children:t(s.instrument)}),e.jsx(n,{children:t(s.strategy_type)}),e.jsx(n,{children:t(s.action)}),e.jsx(n,{children:S(s.priority_score)}),e.jsx(n,{className:"max-w-[420px] truncate",children:t(s.reason)})]},`route-decision-${r}`)),F.length===0&&e.jsx(a,{children:e.jsx(n,{colSpan:6,className:"text-muted-foreground",children:"No router decision trace available yet."})})]})]})})})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsx(m,{children:"Risk Evaluation Trace"}),e.jsx(j,{children:"What Risk Agent did with routed signals, including lots and reject reason."})]}),e.jsxs(g,{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Risk Counters"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["evaluated=",t(N.evaluated)," | blocked_regime=",t(N.blocked_regime)," | rejected_sizing=",t(N.rejected_sizing)," | enqueued=",t(N.enqueued)," | duplicate=",t(N.duplicate)]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(a,{children:[e.jsx(i,{children:"Time"}),e.jsx(i,{children:"Instrument"}),e.jsx(i,{children:"Strategy"}),e.jsx(i,{children:"Result"}),e.jsx(i,{children:"Lots"}),e.jsx(i,{children:"Reason"})]})}),e.jsxs(y,{children:[L.slice(0,40).map((s,r)=>e.jsxs(a,{children:[e.jsx(n,{children:k(s.at)}),e.jsx(n,{children:t(s.instrument)}),e.jsx(n,{children:t(s.strategy_type)}),e.jsx(n,{children:t(s.result)}),e.jsx(n,{children:t(s.final_lots)}),e.jsx(n,{className:"max-w-[420px] truncate",children:t(s.reason)})]},`risk-eval-${r}`)),L.length===0&&e.jsx(a,{children:e.jsx(n,{colSpan:6,className:"text-muted-foreground",children:"No risk evaluation trace yet."})})]})]})})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsx(m,{children:"Options Calc Readiness"}),e.jsx(j,{children:"Real-time readiness of sniper bars and volatility IV/HV calculations."})]}),e.jsxs(g,{className:"grid gap-4 xl:grid-cols-3",children:[e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Sniper Readiness"}),P.map((s,r)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t(s.instrument)," | bars=",t(s.bars)," | ready30=",t(s.ready_30)," | zones=",t(s.zones_cached)]},`sniper-ready-${r}`)),P.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No sniper readiness rows."})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Volatility Readiness"}),H.map((s,r)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t(s.underlying)," | price_bars=",t(s.price_bars)," | has_iv=",t(s.has_iv)," | hv_ready31=",t(s.hv_ready_31)]},`vol-ready-${r}`)),H.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No volatility readiness rows."})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Volatility Snapshots"}),V.map((s,r)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t(s.underlying)," | IV=",S(s.iv,3)," | HV=",S(s.hv,3)," | IVR=",S(s.iv_rank,1)," | ",t(s.vol_regime)]},`vol-snap-${r}`)),V.length===0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"No volatility snapshot yet."})]})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsx(m,{children:"Recent Strategy Decisions"}),e.jsx(j,{children:"Recent journal rows from TOMIC trade lifecycle."})]}),e.jsx(g,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(a,{children:[e.jsx(i,{children:"Time"}),e.jsx(i,{children:"Instrument"}),e.jsx(i,{children:"Strategy"}),e.jsx(i,{children:"Direction"}),e.jsx(i,{children:"P&L"}),e.jsx(i,{children:"Reason"})]})}),e.jsxs(y,{children:[A.slice(0,30).map((s,r)=>{const o=K(s.pnl??s.realized_pnl??s.net_pnl);return e.jsxs(a,{children:[e.jsx(n,{children:k(s.timestamp??s.entry_time??s.created_at)}),e.jsx(n,{children:t(s.instrument??s.underlying)}),e.jsx(n,{children:t(s.strategy_type??s.strategy_id??s.strategy)}),e.jsx(n,{children:t(s.direction)}),e.jsx(n,{className:o!=null&&o<0?"text-red-500":o!=null&&o>0?"text-green-500":"",children:o==null?"—":o.toFixed(2)}),e.jsx(n,{className:"max-w-[280px] truncate",children:t(s.reason??s.entry_reason??s.exit_reason)})]},`${t(s.event_id)}-${r}`)}),A.length===0&&e.jsx(a,{children:e.jsx(n,{colSpan:6,className:"text-muted-foreground",children:"No journal activity yet."})})]})]})})})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsx(m,{children:"Control Audit Trail"}),e.jsx(j,{children:"Operator actions and control-plane history."})]}),e.jsx(g,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(a,{children:[e.jsx(i,{children:"Time"}),e.jsx(i,{children:"User"}),e.jsx(i,{children:"Action"}),e.jsx(i,{children:"Details"}),e.jsx(i,{children:"IP"})]})}),e.jsxs(y,{children:[I.slice(0,40).map(s=>e.jsxs(a,{children:[e.jsx(n,{children:k(s.timestamp)}),e.jsx(n,{children:s.user_id||"—"}),e.jsx(n,{children:e.jsx(w,{variant:"outline",children:s.action})}),e.jsx(n,{className:"max-w-[360px] truncate",children:s.details||"—"}),e.jsx(n,{children:s.ip_address||"—"})]},s.id)),I.length===0&&e.jsx(a,{children:e.jsx(n,{colSpan:5,className:"text-muted-foreground",children:"No audit entries found."})})]})]})})})]})]})}export{ce as default};
