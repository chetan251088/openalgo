import{r as p}from"./vendor-react-BsSNOS8Q.js";import{t as z}from"./trading-QofSYFOO.js";import{u as V,a as T}from"./useMarketStatus-ySaLBNq7.js";import{d as U,g as W}from"./index-CqJWD5ZF.js";function b(t){if(typeof t=="number")return Number.isFinite(t)?t:0;if(typeof t=="string"){const o=Number(t.replace(/,/g,"").trim());return Number.isFinite(o)?o:0}return 0}function Y(t,o={}){const{enabled:n=!0,staleThreshold:l=5e3,useMultiQuotesFallback:s=!0,multiQuotesRefreshInterval:d=3e4,pauseWhenHidden:c=!0}=o,{apiKey:f}=U(),{isMarketOpen:y,isAnyMarketOpen:w}=V(),{isVisible:M,wasHidden:q,timeSinceHidden:Q}=W(),S=w(),[D,C]=p.useState(new Map),m=p.useRef(Date.now()),H=p.useMemo(()=>t.map(e=>({symbol:e.symbol,exchange:e.exchange})),[t]),{data:F,isConnected:L,isPaused:O,isFallbackMode:I}=T({symbols:H,mode:"LTP",enabled:n&&t.length>0}),N=L&&S&&!O,h=p.useCallback(async()=>{if(!(!f||t.length===0||!s))try{const e=t.map(a=>({symbol:a.symbol,exchange:a.exchange})),g=await z.getMultiQuotes(f,e);if(g.status==="success"&&g.results){const a=new Map;g.results.forEach(r=>{const u=`${r.exchange}:${r.symbol}`;r.data&&a.set(u,r.data)}),C(a)}}catch{}},[f,t,s]);return p.useEffect(()=>{if(!n||t.length===0||!s||c&&!M)return;h(),m.current=Date.now();const e=setInterval(()=>{h(),m.current=Date.now()},d);return()=>clearInterval(e)},[n,t.length,s,h,d,c,M]),p.useEffect(()=>{!q||!M||!s||!n||Q>d&&(h(),m.current=Date.now())},[q,M,Q,d,s,n,h]),{data:p.useMemo(()=>t.map(e=>{const g=`${e.exchange}:${e.symbol}`,a=F.get(g),r=D.get(g),u=b(e.quantity),P=b(e.average_price),_=y(e.exchange)&&a?.data?.ltp&&a.lastUpdate&&Date.now()-a.lastUpdate<l,R=!_&&r?.ltp;let i,k="rest";if(_&&a?.data?.ltp?(i=a.data.ltp,k="websocket"):R&&r?.ltp?(i=r.ltp,k="multiquotes"):(i=e.ltp,k="rest"),u===0)return{...e,_dataSource:"rest"};let v=b(e.pnl),E=b(e.pnlpercent);const $=b(e.today_realized_pnl);if(i&&P>0){let x;u>0?x=(i-P)*u:x=(P-i)*Math.abs(u),v=$+x;const A=Math.abs(P*u);E=A>0?v/A*100:0}return{...e,ltp:i,pnl:v,pnlpercent:E,_dataSource:k}}),[t,F,D,y,l]),isLive:N,isConnected:L,isPaused:O,isFallbackMode:I,isAnyMarketOpen:S,multiQuotes:D,refreshMultiQuotes:h}}function Z(t,o){if(!o)return null;let n=0,l=0,s=0;t.forEach(c=>{n+=c.pnl||0;const f=c.average_price||0,y=c.quantity||0,w=c.ltp||f;l+=f*y,s+=w*y});const d=l>0?n/l*100:0;return{...o,totalholdingvalue:s,totalinvvalue:l,totalprofitandloss:n,totalpnlpercentage:d}}export{Z as c,Y as u};
